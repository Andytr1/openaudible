<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.10.1/bootstrap-table.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.10.1/bootstrap-table.min.js"></script>
    <link rel="stylesheet" type="text/css" href="assets/books.css">
    <!-- Created by OpenAudible export web page. -->
    <script src="books.js" type="text/javascript"></script>


    <script>

        function filter() {
            var text = $("#filter").val();
            var rex = new RegExp(text, 'i');
            $('.searchable tr').hide();
            $('.searchable tr').filter(function () {
                return rex.test($(this).text());
            }).show();
        }

        $(document).ready(function () {
            populateBooks(window.myBooks);
            $('#filter').keyup(filter);
        });


        function trunc(str, len) {
            if (str === undefined) return "";
            return str.substring(0, len);
        }


        function resizeSummary(table) {
            table.find('th:nth-child(2), td:nth-child(2)').css('width', '200');
        }

        function populateBooks(arr) {

            var i;
            var data = [];

            for (i = 0; i < arr.length; i++) {
                var book = arr[i];

                var rating = book.rating_average = (book.rating_average !== undefined) ? book.rating_average : "";
                var author = book.author = (book.author !== undefined) ? trunc(book.author, 20) : "";
                var narratedBy = book.narratedBy = (book.narratedBy !== undefined) ? trunc(book.narratedBy, 20) : "";
                var run_time = book.run_time = (book.run_time !== undefined) ? book.run_time : "";
                var summary = trunc(book.description, 2048);


                summary = summary.replace(/(?:\r\n|\r|\n)/g, '<p />');

                var thumb = "<img src='assets/download.jpg'>";

                if (book.image !== undefined)
                    thumb = "<img src='thumb/" + encodeURIComponent(book.image) + "' width='200' height='200'>";		// Thumbnail size


                var linkName = trunc(book.title, 90);
                var mp3 = encodeURIComponent(book.mp3);
                var thumbLink = "<a href='mp3/" + mp3 + "'>" + thumb + "</a> ";

                var info = "<strong>" + trunc(book.title, 50) + "</strong><br>";

                if (author.length > 0)
                    info += "by <i>" + author + "</i><br>";
                if (narratedBy.length > 0)
                    info += "Narrated by " + narratedBy + "<br>";
                info += run_time;
                info += " ";
                info += trunc(book.rating_average, 99);

                var row = {};
                row['title'] = thumbLink;
                row['info'] = info;
                row['purchased'] = book.purchased;
                row['summary'] = summary;

                data.push(row);
            }

            $('#table').bootstrapTable({data: data});


        }

    </script>

    <title>OpenAudible collection of audiobooks</title>
</head>
<body>


<div id="container">
    <div class="row">
        <div class="col-md-4 col-md-offset-2">
            <div class="input-group">

                <div class="input-group-btn">
                    <button class="btn btn-default" type="submit"><i class="glyphicon glyphicon-search"></i></button>
                </div>
                <input type="text" class="form-control" placeholder="Search" name="srch-term" id="filter">

            </div>
        </div>
    </div>


    <div class="row">
        <div class="col-md-12">

            <table id="table" class="table table-striped">
                <thead>
                <tr>
                    <th data-field="title" data-sortable="true">Title</th>
                    <th data-field="info" data-sortable="true">Info</th>
                    <th data-field="purchased" data-sortable="true">Purchased</th>
                    <th data-field="summary" data-sortable="false">Summary</th>
                </tr>
                </thead>
                <tbody class="searchable">
                </tbody>

            </table>
        </div>
    </div>
</div>

</body>
</html>

